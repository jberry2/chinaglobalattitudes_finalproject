---
title: "gather"
author: "Joshua Berry"
date: "10/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(prettyR)
library(rstanarm)
library(ggridges)
library(gtsummary)
library(broom.mixed)
library(gt)
```

## R Markdown

```{r}
anes <- readstata13::read.dta13("anes_timeseries_2012.dta")

china_mil <-
  anes %>%
  select(china_mil)

saveRDS(china_mil, "chinese_military_threat.RDS")

anes %>%
  filter(china_mil %in% c(1, 2, 3)) %>%
  ggplot(aes(x = china_mil)) +
  geom_histogram(fill = "firebrick3") +
  scale_x_discrete(limits = c("1", "2", "3"),
                labels = c("Major threat", "Minor threat", "not a threat")) +
  labs(title = "Americans' Perspectives on the Chinese Military",
       subtitle = "Policy and attitudes toward China, ANES Survey 2012",
       x = "Chinese Military Threat",
       y = "Count") +
  theme_bw()
  
```

```{r}
ccouncil <- 
  load("Chicago_Council/ICPSR_36806/DS0001/36806-0001-Data.rda")

therm2016 <-
  da36806.0001 %>%
  select(Q45_6)

# saveRDS(therm, "china_therm_2016.RDS")

da36806.0001 %>%
  ggplot(aes(x = Q45_6)) +
  geom_histogram(fill = "red", binwidth = 1) +
  scale_x_discrete(limits = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100)) +
  labs(title = "Americans' Feeling Thermometer Towards China ",
       subtitle = "0 = Very Cold; 50 = Not particuarly Warm or Cold;
       100 = Very Warm; Chicago Council Survey 2016",
       x = "American Feelings",
       y = "Count") +
  theme_bw()

da36806.0001 %>%
  ggplot(aes(x = Q45_6, fill = Q1025)) +
  geom_boxplot() +
  facet_wrap(~ Q1025) +
  scale_fill_manual(values = c("salmon", "dodgerblue", "gold", "black")) +
  scale_fill_discrete(name = "Political Identification",
                    labels = c("Republican", "Democrat",
                            "Independent", "Not asked Party Identification")) +
  labs(title = "Americans' Feeling Thermometer Towards China ",
       subtitle = "0 = Very Cold; 50 = Not particuarly Warm or Cold;
       100 = Very Warm; Chicago Council Survey 2016",
       x = "American Feelings",
       y = "Count") +
  theme_bw()
```
```{r}
fit_obj <- stan_glm(Q45_6 ~ Q1025 -1,
                    data = da36806.0001,
                    refresh = 0)

fit_obj %>% 
  as_tibble() %>% 
  select(-sigma) %>% 
  mutate(Democrat = `Q1025(2) Democratic`, Republican = `Q1025(1) Republican`,
         Neither = `Q1025(3) Neither`) %>%
  pivot_longer(cols = c(`Q1025(2) Democratic`,`Q1025(1) Republican`,
                        `Q1025(3) Neither`),
               names_to = "parameter",
               values_to = "Attitude") %>% 
  ggplot(aes(x = Attitude, color = parameter)) +
    geom_histogram(aes(y = after_stat(count/sum(count))),
                   alpha = 0.5, 
                   bins = 100, 
                   position = "identity") +
  scale_color_manual(name = "Party Affiliation",
                       labels = c("Republican", "Democrat", "Independent"),
                     values = c("firebrick1", "dodgerblue", "ivory4")) +
  labs(title = "Posterior Probability Distribution",
      subtitle = "Average attitude toward China; Chicago Council Survey 2016",
      x = "Attitude",
      y = "Probability") +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_classic() +
  geom_vline(xintercept = 50, linetype = 'dashed')
```

```{r}
set.seed(10)
basic_model <- stan_glm(data = pew,
         formula = fav_china_scale ~ trade_flow_prop,
         refresh = 0)

print(basic_model, digits = 4)

tbl_regression(basic_model, intercept = TRUE) %>%
  as_gt() %>%
  tab_header(title = "Regression of Global Attitudes Torwards China",
             subtitle = "The Effect of Total Trade Flow on Favorability 
             Towards China (1 = Very unfavorable, 4 = Very favorable)") %>%
  tab_source_note(md("Pew Global Attidues & Trends Survey (2009-2019), 
                     IMF World Trade Flows (2009-2019),
                     World Bank G20 GDPs (2019-2019)"))


basic_model %>% 
  as_tibble() %>% 
  rename(mu = `(Intercept)`) %>%
  ggplot(aes(x = mu)) +
    geom_histogram(aes(y = after_stat(count/sum(count))),
                   fill = "lightblue4", 
                   color = "gray97",
                   bins = 100) +
    labs(title = "Posterior Probability Distribution of Global Attitudes
         Towards China",
         subtitle = "The Effect of Total Trade Flow on Favorability 
             Towards China (1 = Very unfavorable, 4 = Very favorable)",
         x = "Attitudes Towards China",
         y = "Probability") +
    theme_classic()
```

